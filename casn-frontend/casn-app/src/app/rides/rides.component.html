<ng-container *ngIf="rides && serviceProviders && apptTypes"
              (swipeleft)="swipe($event.type)"
              (swiperight)="swipe($event.type)">
  <div class="dates-rides-wrapper">
    <section class="ride-container">
      <header>
        <div class="title-section">
          <h4>Schedule</h4>
          <!--********************************************************************
                                  Controls (Dates, Filters)
          **********************************************************************-->
          <div class="controls">
            <button mat-mini-fab
                    color="accent"
                    class="control-btn"
                    aria-label="Open map"
                    (click)="toggleMapModal()">
              <mat-icon>map</mat-icon>
            </button>
            <button mat-mini-fab
                    color="accent"
                    class="control-btn"
                    aria-label="Example icon button with a delete icon"
                    (click)="toggleDateFilters()">
              <mat-icon>calendar_today</mat-icon>
            </button>
              <button mat-raised-button
                      color="accent"
                      class="list-view-btn"
                      (click)="toggleSettingsModal()">
              <mat-icon>tune</mat-icon> Filters
            </button>
          </div>
        </div>
        <!--********************************************************************
                                Date Filters, Change Weeks
        **********************************************************************-->
        <nav *ngIf="showDateFilters" class="date-sidebar">
          <span class="week-change-btn"
                (click)="handleChangeWeekClick('prev')"><mat-icon>arrow_back_ios</mat-icon></span>
          <div class="date-card"
               *ngFor="let d of datesToDisplay"
               (click)="toggleActiveDate(d)"
               [ngClass]="{ 'active': d === activeDate }">
            <span>{{ d | date:'EEE' }}</span>
            <span class="day">{{ d | date:'d' }}</span>
          </div>
          <span class="week-change-btn"
                (click)="handleChangeWeekClick('next')"><mat-icon>arrow_forward_ios</mat-icon></span>
        </nav>
        <!--********************************************************************
                                  Drive Status Tabs
        **********************************************************************-->
        <div class="tabs-wrapper">
          <div class="tabs">
            <p class="tab"
               (click)="setActiveTab('all')"
               [ngClass]="activeTab === 'all' ? 'active' : ''">All</p>
            <p class="tab"
               (click)="setActiveTab('approved')"
               [ngClass]="activeTab === 'approved' ? 'active' : ''">Approved</p>
            <p class="tab"
               (click)="setActiveTab('pending')"
               [ngClass]="activeTab === 'pending' ? 'active' : ''">Pending</p>
            <p class="tab"
               (click)="setActiveTab('unstaffed')"
               [ngClass]="activeTab === 'unstaffed' ? 'active' : ''">Unstaffed</p>
          </div>
        </div>
      </header>
      <!-- Spacer so body elements will clear the fixed header -->
      <div [style.marginTop.px]="showDateFilters ? 170 : 110"></div>
      <!--********************************************************************
                                No Rides Today Image
      **********************************************************************-->
      <div *ngIf="ridesToDisplay.length < 1" class="no-rides-card">
          <img src="assets/img/no_rides.png" alt="no rides today">
      </div>
      <!--********************************************************************
                                    Ride Cards
      **********************************************************************-->
      <ng-container *ngFor="let r of ridesToDisplay">
        <div *ngIf="(displayRides[r.driveTo?.statusId] || displayRides[r.driveFrom?.statusId]) && providerIsDisplayed(r.appointment.serviceProviderId)"
             class="appointment-drive-wrapper">
          <app-ride-card [ride]="r"
                         [appointmentType]="apptTypes[r.appointment?.appointmentTypeId].title"
                         [serviceProviderType]="serviceProviders[r.appointment.serviceProviderId].serviceProviderType"
                         [serviceProviderName]="serviceProviders[r.appointment?.serviceProviderId].name"
                         (showRideDetail)="toggleRideModal($event, r)">
          </app-ride-card>
        </div>
      </ng-container>
    </section>
  </div>
</ng-container>
<!--********************************************************************
                          Ride Detail Modal
**********************************************************************-->
<app-ride-detail-modal *ngIf="displayRideModal"
                       [ride]="rideModalContent"
                       [isDriveTo]="showRideModalDriveTo"
                       (closeRideModalClick)="toggleRideModal()"
                       (closeRideModalAndUpdateClick)="toggleRideModal();getRides()"></app-ride-detail-modal>
 <!--********************************************************************
                           Map Modal
 **********************************************************************-->
 <app-map *ngIf="displayMapModal"
          [rides]="rides"
          [startDate]="startDate"
          [endDate]="endDate"
          [activeDate]="activeDate"
          (seeDriveDetailsClick)="onMapDriveDetailsClick($event)"
          (closeMapModalClick)="toggleMapModal()"></app-map>
<!--********************************************************************
                          Display Filters
**********************************************************************-->
<div *ngIf="showSettingsModal" class="modal">
  <div class="modal-content">
    <div class="modal-title">
      <h2>Filter by Service Provider</h2>
      <span class="close"
            (click)="toggleSettingsModal()">X</span>
    </div>
    <div class="modal-body">
      <ng-container *ngFor="let s of objectKeys(serviceProviders)">
        <div class="checkbox-container">
          <mat-checkbox *ngIf="serviceProviders[s].serviceProviderTypeId !== 2"
                            class="mb"
                            [checked]="displayServiceProviders[s]"
                            (change)="displayServiceProviders[s] = $event.source.checked"
                            color="primary">{{ serviceProviders[s].name }}
          </mat-checkbox>
        </div>
      </ng-container>
      <div class="checkbox-container">
        <mat-checkbox [checked]="displayServiceProviders['courthouses']"
                          class="mb"
                          (change)="displayServiceProviders['courthouses'] = $event.source.checked"
                          color="primary">Courthouses
        </mat-checkbox>
      </div>
    </div>
  </div>
</div>

<app-loader *ngIf="loading"></app-loader>
