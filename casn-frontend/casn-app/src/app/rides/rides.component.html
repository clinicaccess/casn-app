<ng-container *ngIf="rides && clinics">
  <!--********************************************************************
                            Date Selection Sidebar
  **********************************************************************-->
  <div class="dates-rides-wrapper">
    <nav class="date-sidebar">
      <div class="date-card"
           *ngFor="let r of objectKeys(rides)"
           (click)="setActiveDate(r)"
           [ngClass]="{ 'active': r === activeDate }">
        {{ r | date:'EEE' }} <span class="day">{{ r | date:'d' }}</span> {{ r | date:'MMM' }}
      </div>
    </nav>
    <!--********************************************************************
                                  Ride Cards
    **********************************************************************-->
    <section class="ride-container">
      <header>
        <!-- TODO: Implement go to today function -->
        <mat-icon class="clicky">today</mat-icon>
        <h1>{{ activeDate | date:'mediumDate' }}</h1>
        <mat-icon class="clicky"
                  (click)="toggleDisplayFiltersModal()">settings</mat-icon>
      </header>
      <div *ngIf="rides[activeDate].length < 1">
        <mat-card class="appointment-card">
          <span class="bolder">No Rides today :(</span>
        </mat-card>
      </div>
      <div *ngFor="let r of rides[activeDate]">
        <ng-container *ngIf="displayRides[r.driveTo?.status] || displayRides[r.driveFrom?.status]">
          <mat-card class="appointment-card">
            <span class="bolder">{{ r.appointment.patientIdentifier }}'s {{ apptTypes[r.appointment?.appointmentTypeId] }} Appointment</span> <br>
            <span class="bold">{{ r.appointment?.appointmentDate | date:'shortTime'}} at {{ clinics[r.appointment?.clinicId].name }}</span> <br>
          </mat-card>
          <div class="drive-container">
            <mat-card *ngIf="displayRides[r.driveTo?.status]"
                      (click)="toggleRideModal(r)"
                      class="drive-card"
                      [ngClass]="{ 'open': r.driveTo.status === 0,
                                   'pending': r.driveTo.status === 1,
                                   'approved': r.driveTo.status === 2 }">
              <div class="drive-card-header">
                <mat-icon class="status-text">{{ getStatusIcon(r.driveTo.status) }}</mat-icon>
                <span class="status-text">{{ getStatusText(r.driveTo.status) }}</span>
              </div>
              <p class="bold">Drive To Clinic</p>
              <p>Pick up at {{ r.driveTo.startAddress }}, {{ r.driveTo.startCity }}, {{ r.driveTo.startState }} {{ r.driveTo.startPostalCode }}.</p>
            </mat-card>
            <mat-card *ngIf="displayRides[r.driveFrom?.status]"
                      (click)="toggleRideModal(r)"
                      class="drive-card"
                      [ngClass]="{ 'open': r.driveFrom.status === 0,
                                   'pending': r.driveFrom.status === 1,
                                   'approved': r.driveFrom.status === 2 }">
              <div class="drive-card-header">
                <mat-icon class="status-text">{{ getStatusIcon(r.driveFrom.status) }}</mat-icon>
                <span class="status-text">{{ getStatusText(r.driveFrom.status) }}</span>
              </div>
              <p class="bold">Drive From Clinic</p>
              <p>Drop off at {{ r.driveFrom.endAddress }}, {{ r.driveFrom.endCity }}, {{ r.driveFrom.endState }} {{ r.driveFrom.endPostalCode }}.</p>
            </mat-card>
          </div>
        </ng-container>
      </div>
    </section>
  </div>
</ng-container>

<!--********************************************************************
                        Settings FAB, Footer
**********************************************************************-->
<footer class="fixed-footer">
  <button type="button"
          mat-raised-button
          color="accent"
          class="clicky bold" (click)="handleChangeWeekClick('prev')"><mat-icon>arrow_back_ios</mat-icon></button>
  {{ this.startDate | date:'MMM d' }} &mdash; {{ this.endDate | date:'MMM d' }}
  <button type="button"
          mat-raised-button
          color="accent"
          class="clicky bold" (click)="handleChangeWeekClick('next')"><mat-icon>arrow_forward_ios</mat-icon></button>
</footer>

<!--********************************************************************
                          Ride Detail Modal
**********************************************************************-->
<div *ngIf="displayRideModal" class="modal">
  <div class="modal-content">
    <h2>Ride details go here.</h2>
    <pre>{{rideModalContent | json}}</pre>
    <button type="button" mat-raised-button (click)="toggleRideModal()" color="accent">Close</button>
  </div>
</div>

<div *ngIf="showDisplayFiltersModal" class="modal">
  <div class="modal-content">
    <h2>Filter Drives</h2>
    <mat-button-toggle-group name="fontStyle" aria-label="Font Style" multiple>
      <mat-button-toggle value="open" [checked]="displayRides[0]" (change)="displayRides[0] = $event.source.checked">Open</mat-button-toggle>
      <mat-button-toggle value="pending" [checked]="displayRides[1]" (change)="displayRides[1] = $event.source.checked">Pending</mat-button-toggle>
      <mat-button-toggle value="approved" [checked]="displayRides[2]" (change)="displayRides[2] = $event.source.checked">Approved</mat-button-toggle>
    </mat-button-toggle-group>
    <br><br>
    <button type="button" mat-raised-button (click)="toggleDisplayFiltersModal()" color="accent">Close</button>
  </div>
</div>
