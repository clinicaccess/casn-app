-- MySQL Script generated by MySQL Workbench
-- Sun Aug 12 16:58:33 2018
-- Model: casn-app data model    Version: 0.02
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema casn-app
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema casn-app
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `casn-app` DEFAULT CHARACTER SET utf8 COLLATE utf8_unicode_ci ;
USE `casn-app` ;

-- -----------------------------------------------------
-- Table `casn-app`.`volunteer`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `casn-app`.`volunteer` (
  `id` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `civiContactId` INT(10) UNSIGNED NOT NULL,
  `firstName` VARCHAR(50) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NOT NULL,
  `lastName` VARCHAR(50) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NOT NULL,
  `mobilePhone` VARCHAR(20) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NOT NULL,
  `googleAccount` VARCHAR(100) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NOT NULL,
  `googleIdentityToken` MEDIUMTEXT NULL,
  `isDriver` BIT(1) NOT NULL,
  `isDispatcher` BIT(1) NOT NULL,
  `isActive` BIT(1) NOT NULL DEFAULT b'1',
  `created` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated` DATETIME NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `casn-app`.`patient`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `casn-app`.`patient` (
  `id` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `civiContactId` INT(10) UNSIGNED NOT NULL,
  `patientIdentifier` VARCHAR(45) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NOT NULL,
  `firstName` VARCHAR(50) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NOT NULL,
  `lastName` VARCHAR(50) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NOT NULL,
  `phone` VARCHAR(20) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NOT NULL,
  `isMinor` BIT(1) NOT NULL,
  `preferredLanguage` VARCHAR(25) NOT NULL,
  `preferredContactMethod` TINYINT(1) NOT NULL COMMENT '0 = Reserved, 1 = Text, 2 = Phone, 3 = Email',
  `created` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated` DATETIME NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `casn-app`.`appointment`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `casn-app`.`appointment` (
  `id` INT(10) UNSIGNED NOT NULL,
  `dispatcherId` INT(10) UNSIGNED NOT NULL,
  `patientId` INT(10) UNSIGNED NOT NULL,
  `clinicId` INT(10) UNSIGNED NOT NULL,
  `pickupLocationVague` VARCHAR(255) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `dropoffLocationVague` VARCHAR(255) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `appointmentDate` DATETIME NOT NULL COMMENT 'Date and time of the patient\'s clinic appointment',
  `appointmentTypeId` INT(10) NOT NULL COMMENT 'Will eventually be a FK reference to an appointmentType table',
  `created` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated` DATETIME NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX `fk_appointment_DispatcherId_idx` (`dispatcherId` ASC),
  INDEX `fk_appointment_PatientId_idx` (`patientId` ASC),
  CONSTRAINT `fk_appointment_DispatcherId`
    FOREIGN KEY (`dispatcherId`)
    REFERENCES `casn-app`.`volunteer` (`id`)
    ON DELETE CASCADE,
  CONSTRAINT `fk_appointment_PatientId`
    FOREIGN KEY (`patientId`)
    REFERENCES `casn-app`.`patient` (`id`)
    ON DELETE CASCADE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `casn-app`.`drive`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `casn-app`.`drive` (
  `id` INT(10) UNSIGNED NOT NULL,
  `appointmentId` INT(10) UNSIGNED NOT NULL,
  `direction` TINYINT(1) UNSIGNED NOT NULL COMMENT '0 = Reserved, 1 = ToClinic, 2 = FromClinic',
  `driverId` INT(10) UNSIGNED NULL DEFAULT NULL,
  `startAddress` VARCHAR(100) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `startCity` VARCHAR(50) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `startState` VARCHAR(30) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `startPostalCode` VARCHAR(10) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `endAddress` VARCHAR(100) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `endCity` VARCHAR(50) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `endState` VARCHAR(30) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `endPostalCode` VARCHAR(10) CHARACTER SET 'utf8' COLLATE 'utf8_unicode_ci' NULL DEFAULT NULL,
  `created` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated` DATETIME NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX `fk_drive_AppointmentId_idx` (`appointmentId` ASC),
  INDEX `fk_drive_DriverId_idx` (`driverId` ASC),
  CONSTRAINT `fk_drive_AppointmentId`
    FOREIGN KEY (`appointmentId`)
    REFERENCES `casn-app`.`appointment` (`id`)
    ON DELETE CASCADE,
  CONSTRAINT `fk_drive_DriverId`
    FOREIGN KEY (`driverId`)
    REFERENCES `casn-app`.`volunteer` (`id`)
    ON DELETE CASCADE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci;


-- -----------------------------------------------------
-- Table `casn-app`.`volunteer_drive`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `casn-app`.`volunteer_drive` (
  `id` INT(10) UNSIGNED NOT NULL,
  `volunteerId` INT(10) UNSIGNED NOT NULL,
  `driveId` INT(10) UNSIGNED NOT NULL,
  `created` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated` DATETIME NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
  `isActive` BIT(1) NOT NULL DEFAULT b'1',
  PRIMARY KEY (`id`),
  INDEX `fk_volunteer_drive_VolunteerId_idx` (`volunteerId` ASC),
  INDEX `fk_volunteer_drive_DriveId_idx` (`driveId` ASC),
  CONSTRAINT `fk_volunteer_drive_DriveId`
    FOREIGN KEY (`driveId`)
    REFERENCES `casn-app`.`drive` (`id`)
    ON DELETE CASCADE,
  CONSTRAINT `fk_volunteer_drive_VolunteerId`
    FOREIGN KEY (`volunteerId`)
    REFERENCES `casn-app`.`volunteer` (`id`)
    ON DELETE CASCADE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8
COLLATE = utf8_unicode_ci
COMMENT = 'XRef table to associate Volunteers (drivers) and the Drives for which they have applied.';


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
